{% extends "layout.html" %}
{% block content %}
<div class="app">
  <!-- Sibar -->
  <aside class="left">
    <h1>Rooms</h1>
    <ul class="room-list">
      {% for r in rooms %}
        <li>
          <form method="post" action="{{ url_for('join_room_route') }}" class="inline-form">
            <input type="hidden" name="room" value="{{ r.name }}"/>
            <button class="roomBtn" type="submit">
              {{ r.name }} {% if r.private %}ğŸ”’{% endif %}
            </button>
          </form>
        </li>
      {% endfor %}
    </ul><div class="hr"></div>

    <h3>Recent User Statuses</h3>
    <ul class="room-list" id="userStatusList">
        {% for user in users_with_status %}
          <li data-username="{{ user.username }}">
            <strong>{{ user.username }}</strong>
            <span class="badge" title="Last updated">{{ user.status_timestamp.strftime('%H:%M') if user.status_timestamp else '' }}</span>
            <p class="user-status">{{ user.status | default('No Status') }}</p>
          </li>
        {% endfor %}
    </ul>
    <div class="hr"></div>
    
    <h3>Create Room</h3>
    <form method="post" action="{{ url_for('create_room') }}" class="create-room-form">
      <input name="room_name" placeholder="room name" required />
      <label><input type="checkbox" name="private"/> Private</label>
      <button type="submit">Create</button>
    </form>

    <h3>Upload Image</h3>
    <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" name="file" id="fileInput" accept="image/*"/>
      <button id="uploadBtn" type="button">Upload</button>
      <div id="preview"></div>
    </form>
  </aside>

  <!-- Main Chat Area -->
  <main class="main">
    <header class="top">
      <div id="currentRoom">Room: global</div>
      <div id="typingIndicator" class="typing"></div>
    </header>


    <!-- Messages -->
    <section id="messages" class="messages"></section>

    <!-- Message Form -->
  <form id="messageForm" class="message-form" autocomplete="off">
  <input id="messageInput" placeholder="Type a message..." />
  <input type="hidden" id="attachmentUrl" />
  
  <div id="recordingInterface">
    <button type="button" id="recordBtn" class="control-btn">ğŸ¤</button>
    
    <div id="recordingState" style="display:none;">
      <span id="recordingIndicator">ğŸ”´ Recording... (<span id="recordTimer">00:00</span>)</span>
      <button type="button" id="stopRecordBtn" class="control-btn">â¹ï¸ Stop</button>
      <button type="button" id="cancelRecordBtn" class="control-btn">âŒ</button>
    </div>
    
    <div id="previewState" style="display:none;">
      <audio id="audioPreview" controls></audio>
      <button type="button" id="sendAudioBtn" class="control-btn">ğŸš€ Send Audio</button>
      <button type="button" id="clearPreviewBtn" class="control-btn">ğŸ—‘ï¸ Clear</button>
    </div>
  </div>
  
  <button type="submit" id="sendTextBtn">Send</button>
</form>
  </main>
</div>

<!-- Scripts -->
<script src="{{ url_for('static', filename='js/chat_auth.js') }}"></script>
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
